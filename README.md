# Курсовой проект «Сервис перевода денег» #

## Описание проекта

Необходимо разработать приложение — REST-сервис. Сервис должен предоставить интерфейс для перевода денег с одной карты на другую по заранее описанной спецификации.
Заранее подготовленное веб-приложение (FRONT) должно подключаться к разработанному сервису без доработок и использовать его функционал для перевода денег.

## Требования к приложению

- Сервис должен предоставлять REST-интерфейс для интеграции с FRONT.
- Сервис должен реализовывать все методы перевода с одной банковской карты на другую, описанные [в протоколе](https://github.com/netology-code/jd-homeworks/blob/master/diploma/MoneyTransferServiceSpecification.yaml).
- Все изменения должны записываться в файл — лог переводов в произвольном формате с указанием:
- даты;
- времени;
- карты, с которой было списание;
- карты зачисления;
- суммы;
- комиссии;
- результата операции, если был.

## Требования в реализации

- Приложение разработано с использованием Spring Boot.
- Использован сборщик пакетов gradle/maven.
- Для запуска используется Docker, Docker Compose .
- Код размещён на GitHub.
- Код покрыт юнит-тестами с использованием mockito.
- Добавлены интеграционные тесты с использованием testcontainers.


## Описание интеграции с FRONT

FRONT доступен [по адресу](https://github.com/serp-ya/card-transfer). Можно скачать репозиторий и запустить Node.js приложение локально (в описании репозитория FRONT добавлена информация, как запустить) или использовать уже развёрнутое демо-приложение [по адресу](https://serp-ya.github.io/card-transfer/) (тогда ваш API должен быть запущен [по адресу](http://localhost:5500/)).
> Весь API FRONT был описан в соответствии [YAML](https://github.com/netology-code/jd-homeworks/blob/master/diploma/MoneyTransferServiceSpecification.yaml)
файла по спецификации OpenAPI (подробнее [по ссылке 1](https://swagger.io/specification/) и [ссылке 2](https://starkovden.github.io/introduction-openapi-and-swagger.html)).

## Архитектура приложения
Приложение представляет собой сервис перевода денег между картами. Вот основные компоненты и их функции:

### 1. Контроллеры (controller)
 MoneyTransferController: отвечает за обработку запросов на перевод денег и подтверждение операций.
Маршруты:
- POST /transfer: обработка перевода.
- POST /confirmOperation: подтверждение операции перевода.
- ExceptionHandlerAdvice: обработчик исключений, чтобы возвращать дружелюбные сообщения об ошибках клиенту.

### 2. Сервисы (service)
 MoneyTransferService: содержит бизнес-логику:
- Проверяет, чтобы карты отправителя и получателя не совпадали.
- Генерирует и логирует ID операции и код подтверждения.
- Проверяет корректность кода подтверждения.

### 3. Репозиторий (repository)
MoneyTransferRepository:
- Сохраняет все операции перевода в памяти (ConcurrentHashMap).
- Генерирует уникальные идентификаторы операций.
- Хранит коды подтверждения операций.

### 4. Запрос-Ответ (request и response)
Запросы:
- MoneyTransferRequest: содержит данные о переводе, включая номера карт, сумму и CVC.
- ConfirmOperationRequest: содержит ID операции и код подтверждения.
Ответы:
- MoneyTransferResponse: возвращает клиенту ID операции.
- ErrorResponse: возвращает сообщение об ошибке.

### 5. Исключения (exception)
InputDataException: выбрасывается при некорректных данных (например, если перевод на ту же карту или неверный код подтверждения).

## Примеры HTTP-запросов

### 1. Перевод денег
Запрос:
POST /transfer HTTP/1.1
Content-Type: application/json
Тело запроса:
json
{
    "cardFromNumber": "1234567890123456",
    "cardToNumber": "6543210987654321",
    "cardFromValidTill": "12/25",
    "cardFromCVV": "111",
    "amount": {
        "value": 100000,
        "currency": "RUB"
    }
}

Ответ:
json
{
    "operationId": "1"
}

### 2. Подтверждение операции
Запрос:
POST /confirmOperation HTTP/1.1
Content-Type: application/json
Тело запроса:

json
Копировать код
{
    "operationId": "1",
    "code": "0000"
}

Ответ:
json
Копировать код
{
    "operationId": "1"
}

### 3. Ошибка при некорректных данных
Запрос:
POST /transfer HTTP/1.1
Content-Type: application/json
Тело запроса:
json
Копировать код
{
    "cardFromNumber": "1234567890123456",
    "cardToNumber": "1234567890123456",
    "cardFromValidTill": "12/25",
    "cardFromCVV": "111",
    "amount": {
        "value": 100000,
        "currency": "RUB"
    }
}

Ответ:
json
{
    "message": "Перевод на ту же самую карту невозможен!"
}

## Логика работы приложения
- Клиент отправляет запрос на перевод денег через POST /transfer.
- Приложение генерирует уникальный ID операции, код подтверждения (0000) и сохраняет данные в репозиторий.
- Клиент получает ID операции и отправляет запрос на подтверждение через POST /confirmOperation, указывая код.
- Приложение проверяет код подтверждения и подтверждает операцию, если всё верно.